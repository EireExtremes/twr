<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>A reproducible workflow and software tools for working with the Global Extreme Sea Level Analysis (GESLA) dataset</title>
    <meta charset="utf-8" />
    <meta name="author" content="Fernando Mayer (Postdoc), Niamh Cahill (PI)" />
    <meta name="date" content="2023-02-23" />
    <script src="slides-twr-gesla_files/header-attrs-2.20/header-attrs.js"></script>
    <link href="slides-twr-gesla_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="slides-twr-gesla_files/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="config/sydney.css" type="text/css" />
    <link rel="stylesheet" href="config/sydney-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# A reproducible workflow and software tools for working with the Global Extreme Sea Level Analysis (GESLA) dataset
]
.author[
### Fernando Mayer (Postdoc), Niamh Cahill (PI)
]
.date[
### 2023-02-23
]

---




class: center, middle, inverse
# Data Science workflows

---
# Data Science workflows

.pull-left[
- Data analysis **is not** a linear, one-step-after-the-other process

- Data analysis **is** a highly iterative and non-linear process

- Information is learned at each step
  - Informs whether (and how) to **refine**, the step that was just
performed
  - Informs whether (and how) to **proceed** to the next step

]
.pull-right[
There are 5 core activities of data analysis:

1. Stating and refining the question
2. Exploring the data
3. Building formal statistical models
4. Interpreting the results
5. Communicating the results
]

---
# Epicycle workflow (Peng &amp; Matsui, 2018)

.pull-left[

For each of the 5 core activities, the following steps are critical

1. Set expectations
2. Collect data, and compare with expectations
3. Revise expectations or fix the data

Iterating through this 3-step process is called the **epicycle of data
analysis**

]
.pull-right[
&lt;img src="img/epicycles.png" width="70%" style="display: block; margin: auto;" /&gt;
]

---
class: center, middle, inverse
# Elements of reproducibility

---
# Elements of reproducibility

.pull-left-60[
1\. **Data**
  - Must be provided the exact same way it was used in the analysis
  - If raw data was processed, both the raw data and the script that
  processed it must be provided

2\. **Code**
  - This automatically excludes point-and-click software
  - It must be executable all at once
  - If there are sets of files, then you need something to assure that
    they will be executed in the correct order
  - Make sure that all needed packages/software are installed (possibly
    in specific versions)
]
.pull-right-40[
3\. **Documentation**
  - Describe to humans what the code is doing (don't make people guess)
  - Describe the results

4\. **Distribution**
  - This could be to you, to your team, to your boss, or to the World
  - Share in a way that anyone can download and reproduce it
]


---
# Elements of reproducibility

The key tools are the ones that makes all the steps **reproducible** by
  **anyone** in your team

&lt;br&gt;

.pull-left-40[
1. Make it reproducible to you first!

2. Make it reproducible to your team

3. Make it reproducible to anyone else
]
.pull-right-60[
&gt; *A scientific project is *computationally reproducible* if another
researcher (**including the future you**) is able to recreate all the
results, given only a set of files and instructions.*

&gt; Justin Kitzes (2018)
]

---
# Reproducibility spectrum

- **Replicability is hard**! (Sometimes even **impossible**!)

- So, we have two options

  1. Do nothing
  2. Reproduce the study

- The general idea is to create a **minimum standard** for judging
scientific claims ([Peng, 2011,
*Science*](http://science.sciencemag.org/content/334/6060/1226.full))


&lt;img src="img/F1.large.jpg" width="70%" style="display: block; margin: auto;" /&gt;

---
class: center, middle, inverse
# Tools for a collaborative workflow

---
# Tools for a collaborative workflow

.pull-left-60[
&lt;br&gt;
&lt;br&gt;
&lt;img src="img/nature_toolkit.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.pull-right-40[
[Nature, 2018](https://www.nature.com/articles/d41586-018-05990-5)

- Use code
- Go open-source
- Track your versions
- Document your analyses
- Automate
- **Replicate your environment**
- **Archive your data**
- Get help. [Software Carpentry](https://software-carpentry.org/).
]

---
# Replicate your environment

.pull-left[
**Virtual environments**

- Makes a project self-contained (or almost) in terms of packages
- Easy to use and record all packages used and **in their specific versions**
- Recorded packages are downloaded and installed in the first use
  - In R: `renv`
  - In Python: `venv`
]

.pull-right[
**Container virtualisation**

- Virtualisation of an environment at the **operating system** level
- Containers are isolated from each other and can have their own
  software in any specific version
- [Docker](https://www.docker.com/) is the main tool
]

**In the reproducibility spectrum:**
.center.content-box-purple[
Script &lt; Script+Data &lt; renv &lt; Docker &lt; renv+Docker
]

---
# Replicate your environment: renv

.pull-left[
### The problem
&lt;br&gt;
&lt;img src="img/shared-library.png" width="80%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
### The solution
&lt;br&gt;
&lt;img src="img/package-cache.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
# Replicate your environment: containers

&lt;br&gt;

&lt;img src="img/containers.jpg" width="80%" style="display: block; margin: auto;" /&gt;

---
# Archive your data

.pull-left[
Use **data repositories** to share data (and get the proper credits)

- [figshare](https://figshare.com/): Allows you to publish figures,
  tables, videos, data, etc.
- [zenodo](https://zenodo.org/): Publish text and data
- [Nature recommended data
  repositories](https://www.nature.com/sdata/policies/repositories):
  Compilation of several repositories
- [re3data](https://www.re3data.org/): *REgistry of REsearch Data
    REpositories* is a tool to search for open access databases

]

.pull-right[
Make it **usable** and **accessible**, with universal formats

- Text format (csv, txt, tsv, etc) - but not always possible or feasible
- Universal formats
  - SQL and variations
  - Arrow, Parquet
]

---
class: center, middle, inverse
# The GESLA dataset

---
# The GESLA dataset

- The GESLA (Global Extreme Sea Level Analysis) project grew out of the
interests of several people in learning more about the changes of
extreme sea levels (Woodworth *et al*, 2016; Haigh *et al*, 2021)

- Sea level data were gathered all over the world from 36 data
  providers

- The current version of the database contains 90,713 years of sea level
  data from 5,119 records

&lt;img src="img/gesla-map.png" width="65%" style="display: block; margin: auto;" /&gt;

---
# The GESLA dataset

.pull-left[
- The whole GESLA dataset is distributed as a single zip file of 5.15 GB
  in size
- When extracted, there are 5,119 CSV files, totalizing
  38.72 GB of data
- There are a Matlab script and a Python script to deal with these files
  - They are able to read a single file (or a list of them), and made
    them available in memory
  - However, due to the huge amount of data in each file, this can be
    infeasible in any (RAM) language
]

.pull-right[
### Our goal

- To standardize the distribution of this dataset
- To make easier to fetch data without downloading everything
- To achieve that:
  - Convert CSV files to a lighter, universal and more efficient file
    format
  - Create a web interface with R Shiny to filter the data
  - Create a companion R package to fetch and deal with this data via an
    API

]


---
# The Apache Parquet format

.pull-left[
- From the CSVs and the Python script, the files were converted to the
  [Apache Parquet](https://parquet.apache.org) format
- Apache Parquet is an **open source**, column-oriented data file format
  designed for efficient data storage and retrieval
- This format can then be read by many languages (R, Python, Matlab,
etc)
]
.pull-right[
- The Parquet format can be then handled by the [Apache
  Arrow](https://arrow.apache.org) language for *in-memory* analytics
- *In-memory* here means that the computations are made efficiently in
  RAM memory, but **without** actually loading the whole dataset to RAM

&lt;img src="https://djnavarro.net/slides-data-thread-2022/img/data-interchange-2.svg" width="90%" style="display: block; margin: auto;" /&gt;
]


---
# The GESLA dataset

.pull-left-40[
- After conversion to Parquet, the whole GESLA dataset shrinked to
  7.03 GB, with the same 5119 files

- Theses files could then be stored in an AWS bucket

- The arrow R package is able to connect with this bucket, and you can
  make operations locally, without having to download the whole dataset
]


.pull-right-60[


```r
library("arrow")
path &lt;- s3_bucket("gesla-dataset/parquet_files",
                  anonymous = TRUE)
da &lt;- open_dataset(path, format = "parquet")
da |&gt; nrow()/1e9
## [1] 1.172436
object.size(da)
## 504 bytes
```

]

---
# The GESLA dataset

- The web interface was developed as a "stand-alone" application,
  querying the AWS bucket

- Users can select subsets of data and download it in CSV or Parquet
  formats

&lt;img src="img/geslaR-app.png" width="90%" style="display: block; margin: auto;" /&gt;

---
# The GESLA dataset

.pull-left-40[
- Besides the Parquet file format, we are using **renv** and:
  - Developing an API interface with R package **pumbler**
  - Developing a **docker** image with package, code and data
]

.pull-right-60[
&lt;img src="img/geslaR-renv.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---
exclude: true
# References


```
# You haven't cited any references in this bibliography yet.
```

NULL

---
# Acknowledgements

This work has emanated from research conducted with the financial
support of Science Foundation Ireland and co-funded by GSI under Grant
number 20/FFP-P/8610.

.pull-left[
&lt;img src="img/geological-survey.png" width="70%" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="img/sfi.png" width="70%" style="display: block; margin: auto;" /&gt;
]

&lt;img src="config/maynooth.png" width="20%" style="display: block; margin: auto;" /&gt;


---
class: center, middle, inverse
# Thanks!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
